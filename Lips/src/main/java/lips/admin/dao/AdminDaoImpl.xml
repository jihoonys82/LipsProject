<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 <mapper namespace="lips.admin.dao.AdminDao">

 	<select id="selUserInfo" resultType="lips.userinfo.dto.User" parameterType="lips.admin.util.Paging">
	 	SELECT * FROM
	 		(SELECT rownum rnum, U.* FROM
	 			(SELECT * FROM USERINFO ORDER BY USERID DESC) U ORDER BY rnum)
	 		WHERE rnum 
	 		BETWEEN #{startNo} AND #{endNo}
 	</select>
 	
 	<select id="selIsLeader" resultType="int" parameterType="lips.userinfo.dto.User">
 		SELECT count(*) FROM userinfo ui, projectinfo pi
		WHERE pi.projectLeader = ui.userid AND userid = #{userId}
 	</select>
  
 	<select id="selUTotalCnt" resultType="int">
 		SELECT COUNT(*) FROM USERINFO
 	</select>
 	
	<select id="selNewUCnt" resultType="int">
		SELECT COUNT(*) FROM USERINFO WHERE CREATEDATE > SYSDATE-30
	</select> 	
 
	<select id="selClosedUCnt" resultType="int">
		SELECT COUNT(*) FROM USERINFO WHERE BLOCKED=0 AND USERLEVEL=0
	</select> 
 	
	<select id="selPCreaterCnt" resultType="int">
		SELECT COUNT(PROJECTCREATER) FROM PROJECTINFO
	</select>
	
	<select id="selUserByUid" resultType="lips.userinfo.dto.User" parameterType="lips.userinfo.dto.User">
		SELECT * FROM USERINFO WHERE USERID= #{userId}
	</select>
	
	<select id="selProByPid" resultType="lips.project.dto.ProjectDto" parameterType="lips.project.dto.ProjectDto">
		SELECT * FROM PROJECTINFO WHERE PROJECTID= #{projectId}
	</select>
	
	<select id="selPTotalCnt" resultType="int">
 		SELECT COUNT(*) FROM PROJECTINFO
 	</select>
 	
 	 <select id="selProInfo" resultType="lips.project.dto.ProjectDto" parameterType="lips.admin.util.Paging">
	 	SELECT * FROM
	 		(SELECT rownum rnum, P.* FROM
	 			(SELECT * FROM PROJECTINFO ORDER BY PROJECTID DESC) P ORDER BY rnum)
	 		WHERE rnum 
	 		BETWEEN #{startNo} AND #{endNo} 
 	</select>
	
	<select id="selProByUid" parameterType="lips.userinfo.dto.User" resultType="lips.project.dto.ProjectDto">
		SELECT pi.projectName
			FROM project_member pm, projectinfo pi
		WHERE pm.projectId = pi.projectId AND userId= #{userId}
	</select>
	
	<update id="upUserAccClose" parameterType="lips.userinfo.dto.User">
		UPDATE USERINFO SET USERLEVEL = 0, BLOCKED = 1 WHERE USERID=#{userId}
	</update>
	
	<update id="upUserAccReopen" parameterType="lips.userinfo.dto.User">
		UPDATE USERINFO SET USERLEVEL = 1, BLOCKED = 0 WHERE USERID=#{userId}		
	</update>
	
	<select id="selNewPCnt" resultType="int">
		SELECT COUNT(*) FROM PROJECTINFO WHERE CREATEDATE > SYSDATE-30
	</select>
	
	<select id="selClosePCnt" resultType="int">
		SELECT COUNT(*) FROM PROJECTINFO WHERE STATUS = 'CLOSE'
	</select>
	
	<select id="selOpenPCnt" resultType="int">
		SELECT COUNT(*) FROM PROJECTINFO WHERE STATUS = 'OPEN'	
	</select>
	
 </mapper>  