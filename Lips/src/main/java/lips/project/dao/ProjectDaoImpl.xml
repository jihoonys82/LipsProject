<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="lips.project.dao.ProjectDao">
 
 
 	<!--프로젝트 조회 (초대 코드를 바탕으로)  -->
 	
 	<select id="selProbyinvite" parameterType="lips.project.dto.ProjectDto" resultType="lips.project.dto.ProjectDto">
 	SELECT* FROM project_member pm, project_invitation pi
	WHERE pm.PROJECTID = pi.PROJECTID AND INVITECODE=#{invitecode}
 	</select>
 	
 	
 	
 	<!-- 프로젝트 조회(유저정보를 바탕으로) -->
 	<select id="selPro" parameterType="lips.userinfo.dto.User" resultType="lips.project.dto.ProjectDto">
 		SELECT * FROM projectinfo pf, project_member pm
	WHERE pf.PROJECTID = pm.PROJECTID AND USERID=#{userId}
 	</select>
 	
 	<!-- 프로젝트 멤버 조회 -->
 	<select id="selProMember" parameterType="lips.project.dto.ProjectDto" resultType="lips.userinfo.dto.User">
 		SELECT ui.userId,ui.email,ui.createdate,ui.nick,ui.blocked,ui.userlevel,ui.phone,ui.birth FROM project_member pm, userinfo ui
 		WHERE pm.userId = ui.userId
 		AND pm.projectId=#{projectId}
 	</select>
 	
 	<!-- 프로젝트 인서트 -->
 	<insert id="inPro" parameterType="lips.project.dto.ProjectDto">
 	
 		INSERT INTO projectinfo 
 		(projectId,projectName,projectKey,projectOpen,projectCreater,projectLeader,closeDate,status,projectDesc) 
 		VALUES 
 		(project_SEQ.NEXTVAL,#{projectName},#{projectKey},#{projectOpen},#{projectCreater},#{projectCreater},#{closeDate},'OPEN',#{projectDesc} )
 	
 	
 	<!-- 셀렉트키   -->
 	<!-- 파라미터타입(dto)의  변수(projectId)에 리절트타입(Interger)로 값을 반환   -->
 	  <selectKey keyProperty="projectId" resultType="Integer" order="AFTER">
 	  SELECT project_SEQ.CURRVAL FROM dual
       </selectKey>
 	</insert>
 	
 	
 	<!-- 프로젝트 멤버 인서트 ( 프로젝트 인서트와 동시에 실행) -->
 	<insert id="inProMember" parameterType="hashmap">

 		INSERT INTO project_member 
 		(projectId,userId) VALUES
 		(#{projectId},#{user.userId} )
 	
 	</insert>
 	
 	<!-- 프로젝트 카테코리 인서트 ( 프로젝트 인서트와 동시에 실행) -->
 	<insert id="inProct" parameterType="lips.project.dto.ProjectDto">
		INSERT INTO issue_category VALUES(#{projectId}, 1, 1)
 	
 	</insert>
 	
 	<!-- 프로젝트 초대코드 인서트( 프로젝트 인서트와 동시에 실행)  -->
 	<insert id="inProic" parameterType="hashmap">

 		INSERT INTO Project_invitation 
 		(projectId, expirydate, invitecode) VALUES
 		(#{projectId} ,sysdate ,#{invitecode} )
 	
 	
<!--  		셀렉트키//   파라미터가 해쉬맵땐 어떻게 받아오지?? -->
 	<!-- 파라미터타입(hashmap)의 변수(projectId)에 리절트타입(String)로 값을 반환   -->
<!--  	  <selectKey keyProperty="invitecode" resultType="String" order="AFTER"> -->
<!--  	  SELECT INVITECODE FROM Project_invitation WHERE projectId=#{projectId}  -->
<!--        </selectKey> -->
 	
 	</insert>
 	
 	
 	
 	

 	
 	
 </mapper>